{% extends 'admin_dashboard/base.html' %}

{% block content %}
<!-- Page Heading -->
<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">Settings</h1>
</div>

<!-- Content Row -->
<div class="row">
    <!-- System Settings Card -->
    <div class="col-lg-6 mb-4">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">System Settings</h6>
            </div>
            <div class="card-body">
                <form method="post" action="{% url 'admin_dashboard:settings' %}" id="settingsForm">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="siteName">Site Name</label>
                        <input type="text" class="form-control" id="siteName" value="High School Map" name="site_name">
                    </div>
                    <div class="form-group">
                        <label for="adminEmail">Admin Email</label>
                        <input type="email" class="form-control" id="adminEmail" value="admin@example.com" name="admin_email">
                    </div>
                    <div class="form-group">
                        <label for="itemsPerPage">Items Per Page</label>
                        <select class="form-control" id="itemsPerPage" name="items_per_page">
                            <option value="10">10</option>
                            <option value="25" selected>25</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Email Settings Card -->
    <div class="col-lg-6 mb-4">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Email Settings</h6>
            </div>
            <div class="card-body">
                <div id="emailSettings">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="smtpHost">SMTP Host</label>
                        <input type="text" class="form-control" id="smtpHost" value="smtp.example.com" name="smtp_host">
                    </div>
                    <div class="form-group">
                        <label for="smtpPort">SMTP Port</label>
                        <input type="number" class="form-control" id="smtpPort" value="587" name="smtp_port">
                    </div>
                    <div class="form-group">
                        <label for="smtpUsername">SMTP Username</label>
                        <input type="text" class="form-control" id="smtpUsername" name="smtp_username">
                    </div>
                    <div class="form-group">
                        <label for="smtpPassword">SMTP Password</label>
                        <input type="password" class="form-control" id="smtpPassword" name="smtp_password">
                    </div>
                    <div class="form-group form-check">
                        <input type="checkbox" class="form-check-input" id="useTLS" name="use_tls" checked>
                        <label class="form-check-label" for="useTLS">Use TLS</label>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Email Settings</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Backup & Restore -->
<div class="row">
    <div class="col-12">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Backup & Restore</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h5>Create Backup</h5>
                        <p>Create a complete backup of the system data.</p>
                        <a href="#" class="btn btn-primary">
                            <i class="fas fa-download fa-sm text-white-50"></i> Create Backup
                        </a>
                    </div>
                    <div class="col-md-6">
                        <h5>Restore from Backup</h5>
                        <div class="form-group">
                            <div class="custom-file">
                                <input type="file" class="custom-file-input" id="backupFile">
                                <label class="custom-file-label" for="backupFile">Choose backup file</label>
                            </div>
                        </div>
                        <button type="button" class="btn btn-success">
                            <i class="fas fa-upload fa-sm text-white-50"></i> Restore
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Danger Zone -->
<div class="row">
    <div class="col-12">
        <div class="card shadow mb-4 border-left-danger">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-danger">Danger Zone</h6>
            </div>
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h5 class="text-danger">Reset All Settings</h5>
                        <p class="mb-0">This will reset all settings to their default values. This action cannot be undone.</p>
                    </div>
                    <div class="col-md-4 text-right">
                        <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#resetSettingsModal">
                            <i class="fas fa-redo fa-sm text-white-50"></i> Reset Settings
                        </button>
                    </div>
                </div>
                
                <hr>
                
                <div class="row align-items-center mt-4">
                    <div class="col-md-8">
                        <h5 class="text-danger">Delete All Data</h5>
                        <p class="mb-0">This will permanently delete all data from the system. This action cannot be undone.</p>
                    </div>
                    <div class="col-md-4 text-right">
                        <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#deleteDataModal">
                            <i class="fas fa-trash fa-sm text-white-50"></i> Delete All Data
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Reset Settings Modal -->
<div class="modal fade" id="resetSettingsModal" tabindex="-1" role="dialog" aria-labelledby="resetSettingsModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-danger" id="resetSettingsModalLabel">Reset All Settings</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to reset all settings to their default values?</p>
                <p class="text-danger"><strong>Warning:</strong> This action cannot be undone.</p>
                <div class="form-group">
                    <label for="confirmReset">Type "RESET" to confirm</label>
                    <input type="text" class="form-control" id="confirmReset" placeholder="Type RESET to confirm">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmResetBtn" disabled>Reset Settings</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Data Modal -->
<div class="modal fade" id="deleteDataModal" tabindex="-1" role="dialog" aria-labelledby="deleteDataModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-danger" id="deleteDataModalLabel">Delete All Data</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>This will permanently delete all data from the system, including:</p>
                <ul>
                    <li>User accounts</li>
                    <li>Building information</li>
                    <li>Analytics data</li>
                    <li>All other application data</li>
                </ul>
                <p class="text-danger"><strong>Warning:</strong> This action cannot be undone. Please make sure you have a backup before proceeding.</p>
                <div class="form-group">
                    <label for="confirmDelete">Type "DELETE" to confirm</label>
                    <input type="text" class="form-control" id="confirmDelete" placeholder="Type DELETE to confirm">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn" disabled>Delete All Data</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Enable/disable reset button based on input
$('#confirmReset').on('input', function() {
    if ($(this).val() === 'RESET') {
        $('#confirmResetBtn').prop('disabled', false);
    } else {
        $('#confirmResetBtn').prop('disabled', true);
    }
});

// Enable/disable delete button based on input
$('#confirmDelete').on('input', function() {
    if ($(this).val() === 'DELETE') {
        $('#confirmDeleteBtn').prop('disabled', false);
    } else {
        $('#confirmDeleteBtn').prop('disabled', true);
    }
});

// Handle reset settings
$('#confirmResetBtn').on('click', function() {
    // Add your reset logic here
    alert('All settings have been reset to their default values.');
    $('#resetSettingsModal').modal('hide');
});

// Handle delete all data
$('#confirmDeleteBtn').on('click', function() {
    // Add your delete logic here
    alert('All data has been deleted.');
    $('#deleteDataModal').modal('hide');
});

// Show file name when a file is selected
$('.custom-file-input').on('change', function() {
    var fileName = $(this).val().split('\\').pop();
    $(this).next('.custom-file-label').html(fileName || 'Choose backup file');
});
</script>
{% endblock %}
